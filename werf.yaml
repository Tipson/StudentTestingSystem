configVersion: 1
project: student-testing-system

---
# Базовый образ со всеми build артефактами
image: solution-build-artifacts
dockerfile: Dockerfile
context: ./src/backend
args:
  DOTNET_SDK_VERSION: "10.0-alpine3.22"

---
# Assessment WebAPI
image: assessment-api
dockerfile: Dockerfile
context: ./docker/dotnet/Assessment
args:
  ASPNET_VERSION: "10.0-alpine3.22"
dependencies:
  - image: solution-build-artifacts
    imports:
      - type: ImageName
        targetBuildArg: SOLUTION_IMAGE_NAME

---
# Media WebAPI
image: media-api
dockerfile: Dockerfile
context: ./docker/dotnet/Media
args:
  ASPNET_VERSION: "10.0-alpine3.22"
dependencies:
  - image: solution-build-artifacts
    imports:
      - type: ImageName
        targetBuildArg: SOLUTION_IMAGE_NAME

---
# Identity WebAPI
image: identity-api
dockerfile: Dockerfile
context: ./docker/dotnet/Identity
args:
  ASPNET_VERSION: "10.0-alpine3.22"
dependencies:
  - image: solution-build-artifacts
    imports:
      - type: ImageName
        targetBuildArg: SOLUTION_IMAGE_NAME

---
# Assessment Migrations
image: assessment-migrations
dockerfile: Dockerfile
context: ./docker/dotnet/Migrations/Assessment
args:
  ASPNET_VERSION: "10.0-alpine3.22"
dependencies:
  - image: solution-build-artifacts
    imports:
      - type: ImageName
        targetBuildArg: SOLUTION_IMAGE_NAME

---
# Media Migrations
image: media-migrations
dockerfile: Dockerfile
context: ./docker/dotnet/Migrations/Media
args:
  ASPNET_VERSION: "10.0-alpine3.22"
dependencies:
  - image: solution-build-artifacts
    imports:
      - type: ImageName
        targetBuildArg: SOLUTION_IMAGE_NAME

---
# Identity Migrations
image: identity-migrations
dockerfile: Dockerfile
context: ./docker/dotnet/Migrations/Identity
args:
  ASPNET_VERSION: "10.0-alpine3.22"
dependencies:
  - image: solution-build-artifacts
    imports:
      - type: ImageName
        targetBuildArg: SOLUTION_IMAGE_NAME

---
# Grading WebAPI
image: grading-api
dockerfile: Dockerfile
context: ./docker/dotnet/Grading
args:
  ASPNET_VERSION: "10.0-alpine3.22"
dependencies:
  - image: solution-build-artifacts
    imports:
      - type: ImageName
        targetBuildArg: SOLUTION_IMAGE_NAME